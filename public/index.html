<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>스마트 학습지 저장소</title>
  <meta name="description" content="학습지를 공유하고 포인트를 적립하는 스마트 저장소">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="toast-container"></div>

  <!-- AUTH PAGE -->
  <div id="auth-page" class="auth-page">
    <div class="auth-wrapper">
      <div class="auth-card">
        <h1>학습지 저장소</h1>
        <p>학습지를 공유하고 포인트를 적립하세요!</p>
        <div class="auth-tabs">
          <button class="auth-tab active" onclick="switchAuthTab('user')">유저 로그인</button>
          <button class="auth-tab" onclick="switchAuthTab('admin')">관리자</button>
        </div>
        <!-- User Login -->
        <div id="user-auth-form">
          <div class="form-group">
            <label>계정 이름</label>
            <input type="text" id="auth-username" class="form-input" placeholder="관리자가 만든 계정 이름 입력">
          </div>
          <div id="password-section" class="hidden">
            <div class="form-group">
              <label id="password-label">비밀번호</label>
              <div class="pw-wrapper">
                <input type="password" id="auth-password" class="form-input" placeholder="비밀번호 입력">
                <button type="button" class="pw-toggle" onclick="togglePw('auth-password',this)">show</button>
              </div>
            </div>
            <div id="password-confirm-group" class="form-group hidden">
              <label>비밀번호 확인</label>
              <div class="pw-wrapper">
                <input type="password" id="auth-password-confirm" class="form-input" placeholder="비밀번호 다시 입력">
                <button type="button" class="pw-toggle" onclick="togglePw('auth-password-confirm',this)">show</button>
              </div>
            </div>
          </div>
          <button id="auth-next-btn" class="btn btn-primary btn-full" onclick="handleUserAuth()">다음</button>
        </div>
        <!-- Admin Login -->
        <div id="admin-auth-form" class="hidden">
          <div id="admin-status-msg" class="text-center" style="margin-bottom:16px;color:var(--text2);font-size:.9rem">
          </div>
          <div class="form-group">
            <label>관리자 아이디</label>
            <input type="text" id="admin-username" class="form-input" placeholder="관리자 아이디">
          </div>
          <div class="form-group">
            <label>관리자 비밀번호</label>
            <div class="pw-wrapper">
              <input type="password" id="admin-password" class="form-input" placeholder="관리자 비밀번호">
              <button type="button" class="pw-toggle" onclick="togglePw('admin-password',this)">show</button>
            </div>
          </div>
          <button class="btn btn-primary btn-full" onclick="handleAdminAuth()">로그인</button>
        </div>
      </div>

      <!-- 안내 메모 -->
      <div class="auth-memo">
        <div class="memo-title">로그인 안내</div>
        <div class="memo-body">
          <div class="memo-item">
            <span class="memo-num">1</span>
            <span>계정 이름에 <strong>이름 석 자</strong>를 입력하세요.<br><span class="memo-example">예: 홍길동</span></span>
          </div>
          <div class="memo-item">
            <span class="memo-num">2</span>
            <span>첫 로그인 시 <strong>비밀번호를 직접 설정</strong>하게 됩니다.</span>
          </div>
          <div class="memo-item">
            <span class="memo-num">3</span>
            <span>설정한 비밀번호는 <strong>꼭 기억</strong>해 주세요!</span>
          </div>
        </div>
        <div class="memo-footer">관리자가 먼저 계정을 만들어야 로그인이 가능합니다.</div>
      </div>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="dashboard hidden">
    <!-- Mobile Header -->
    <div class="mobile-header flex items-center justify-between">
      <h1>
        <img src="/logo.png" alt="logo" class="mobile-logo-img">
        <span class="logo-title">학습지 저장소</span>
        <span class="logo-sub" style="margin-left:0">&nbsp;feat. 유준's class 4</span>
      </h1>
      <span id="mobile-points" style="color:var(--accent2);font-weight:700;font-size:.9rem"></span>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <img src="/logo.png" alt="logo" class="sidebar-logo-img">
        <div class="logo-text">
          <span class="logo-title">학습지 저장소</span>
          <span class="logo-sub">feat. 유준's class 4</span>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-item active" data-page="upload" onclick="navigateTo('upload')">
          업로드
        </div>
        <div class="nav-item" data-page="browse" onclick="navigateTo('browse')">
          다운로드
        </div>
        <div class="nav-item" data-page="friends" onclick="navigateTo('friends')">
          친구
        </div>
        <div class="nav-item" data-page="classmates" onclick="navigateTo('classmates')">
          학우들
        </div>
        <div class="nav-item" data-page="profile" onclick="navigateTo('profile')">
          계정
        </div>
        <div class="nav-item" data-page="history" onclick="navigateTo('history')">
          포인트 기록
        </div>
        <div class="nav-item" data-page="quiz" onclick="navigateTo('quiz')">
          퀴즈
        </div>
      </nav>
      <div class="sidebar-footer">
        <div class="sidebar-user">
          <div class="avatar" id="sidebar-avatar"></div>
          <div class="info">
            <div class="name" id="sidebar-name"></div>
            <div class="pts" id="sidebar-points"></div>
          </div>
        </div>
        <button class="btn btn-secondary btn-sm btn-full" style="margin-top:12px" onclick="logout()">로그아웃</button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- UPLOAD PAGE -->
      <div id="page-upload" class="page">
        <div class="page-header">
          <h2>학습지 업로드</h2>
          <p>과목을 선택하고 학습지를 업로드하세요</p>
        </div>
        <div class="card" style="max-width:600px">
          <div class="form-group">
            <label>과목 선택</label>
            <div class="flex gap-sm">
              <select id="upload-subject" class="form-input" style="flex:1"></select>
              <button class="btn btn-secondary btn-sm" onclick="openNewSubjectModal()">+ 새 과목</button>
            </div>
          </div>
          <div class="form-group">
            <label>학습지 이름</label>
            <input type="text" id="upload-title" class="form-input" placeholder="예: 2학기 중간고사 정리">
          </div>
          <div class="form-group">
            <label>표지 이미지 (선택)</label>
            <label class="file-input-label" id="thumb-label">
              <span>이미지 선택</span>
              <input type="file" id="upload-thumbnail" accept="image/*" style="display:none"
                onchange="onThumbSelect(this)">
            </label>
          </div>
          <div class="form-group">
            <label>학습지 파일</label>
            <label class="file-input-label" id="file-label">
              <span>파일 선택 (PDF, 이미지, DOCX)</span>
              <input type="file" id="upload-file" accept=".pdf,.png,.jpg,.jpeg,.docx,.doc" style="display:none"
                onchange="onFileSelect(this)">
            </label>
          </div>
          <button class="btn btn-primary btn-full" onclick="handleUpload()" id="upload-btn">업로드하기</button>
        </div>
      </div>

      <!-- BROWSE PAGE -->
      <div id="page-browse" class="page hidden">
        <div class="page-header">
          <h2>학습지 탐색</h2>
          <p>과목을 선택하고 학습지를 다운로드하세요</p>
        </div>
        <div id="subject-list" class="card-grid"></div>
        <div id="worksheet-list-section" class="hidden">
          <div class="flex items-center justify-between" style="margin-bottom:16px">
            <button class="btn btn-secondary btn-sm" onclick="backToSubjects()">← 과목 목록</button>
            <h3 id="current-subject-name" style="font-weight:700"></h3>
          </div>
          <div class="sort-tabs">
            <button class="sort-tab active" onclick="sortWorksheets('latest')">최신순</button>
            <button class="sort-tab" onclick="sortWorksheets('views')">인기순</button>
          </div>
          <div id="worksheet-list" class="card-grid"></div>
        </div>
      </div>

      <!-- PROFILE PAGE -->
      <div id="page-profile" class="page hidden">
        <div class="page-header">
          <h2>내 프로필</h2>
        </div>
        <div class="stat-grid" id="profile-stats"></div>
        <div class="profile-section">
          <h3>기여 학습지 TOP 3</h3>
          <div id="top-worksheets" class="user-list"></div>
        </div>
      </div>

      <!-- FRIENDS PAGE -->
      <div id="page-friends" class="page hidden">
        <div class="page-header">
          <h2>맞팔 친구</h2>
          <p>서로 맞팔로우한 친구들의 인기 학습지 & 포인트 전송</p>
        </div>
        <div class="profile-section" style="margin-bottom:24px">
          <h3>친구가 올린 베스트 학습지</h3>
          <div id="friends-best-worksheets" class="card-grid"></div>
        </div>
        <div class="profile-section">
          <h3>포인트 전송</h3>
          <div class="form-group">
            <label>받는 친구</label>
            <select id="transfer-to" class="form-input"></select>
          </div>
          <div class="form-group">
            <label>포인트</label>
            <input type="number" id="transfer-amount" class="form-input" placeholder="전송할 포인트" min="1">
          </div>
          <p style="font-size:.8rem;color:var(--text2);margin-bottom:12px">수수료 8%가 부과됩니다</p>
          <button class="btn btn-primary" onclick="handleTransfer()">전송하기</button>
        </div>
      </div>

      <!-- CLASSMATES PAGE -->
      <div id="page-classmates" class="page hidden">
        <div class="page-header">
          <h2>학우들</h2>
          <p>전체 학우 목록에서 팔로우/언팔로우하세요</p>
        </div>
        <div class="flex gap-sm" style="margin-bottom:16px">
          <button class="classmate-tab sort-tab active" onclick="showClassmatesTab('all')">전체 학우</button>
          <button class="classmate-tab sort-tab" onclick="showClassmatesTab('following')">팔로잉</button>
          <button class="classmate-tab sort-tab" onclick="showClassmatesTab('followers')">팔로워</button>
        </div>
        <div id="classmates-list" class="user-list"></div>
      </div>

      <!-- HISTORY PAGE -->
      <div id="page-history" class="page hidden">
        <div class="page-header">
          <h2>포인트 기록</h2>
          <p>포인트 적립 및 사용 내역</p>
        </div>
        <div id="history-list"></div>
      </div>

      <!-- QUIZ PAGE -->
      <div id="page-quiz" class="page hidden">
        <div class="page-header">
          <h2>퀴즈</h2>
          <p>퀴즈를 풀거나 직접 만들어보세요</p>
        </div>

        <div class="flex gap-sm" style="margin-bottom:16px">
          <button class="quiz-main-tab sort-tab active" onclick="showQuizMainTab('play')">퀴즈 풀기</button>
          <button class="quiz-main-tab sort-tab" onclick="showQuizMainTab('create')">퀴즈 만들기</button>
          <button class="quiz-main-tab sort-tab" onclick="showQuizMainTab('leaderboard')">주간 랭킹</button>
        </div>

        <!-- 퀴즈 풀기 섹션 -->
        <div id="quiz-play-section">
          <div id="quiz-list" class="card-grid"></div>
        </div>

        <!-- 퀴즈 만들기 섹션 -->
        <div id="quiz-create-section" class="hidden">
          <div class="card" style="max-width:600px">
            <div class="form-group">
              <label>퀴즈 제목</label>
              <input type="text" id="quiz-title" class="form-input" placeholder="예: 2학기 중간 영어 단어">
            </div>
            <div class="form-group">
              <label>과목 (선택)</label>
              <select id="quiz-subject" class="form-input"></select>
            </div>
            <div id="quiz-questions-container">
              <h3 style="margin-bottom:12px">문제 목록</h3>
            </div>
            <button class="btn btn-secondary btn-sm" style="margin-bottom:16px" onclick="addQuizQuestion()">+ 문제
              추가</button>
            <button class="btn btn-primary btn-full" onclick="submitQuiz()">퀴즈 업로드</button>
          </div>
        </div>

        <!-- 주간 랭킹 섹션 -->
        <div id="quiz-leaderboard-section" class="hidden">
          <div class="card" style="max-width:500px">
            <h3 style="margin-bottom:16px">이번 주 퀴즈 랭킹 TOP 10</h3>
            <p style="font-size:.8rem;color:var(--text2);margin-bottom:16px">1등에게는 매주 1000pt가 지급됩니다!</p>
            <div id="leaderboard-list" class="user-list"></div>
          </div>
        </div>
      </div>

      <!-- QUIZ GAME MODAL -->
      <div id="quiz-game-container" class="hidden"
        style="position:fixed;inset:0;z-index:1000;background:var(--bg);overflow-y:auto;padding:20px">
        <div style="max-width:700px;margin:0 auto">
          <div class="flex items-center justify-between" style="margin-bottom:20px">
            <h2 id="quiz-game-title"></h2>
            <button class="btn btn-secondary btn-sm" onclick="exitQuizGame()">나가기</button>
          </div>
          <div id="quiz-game-area"></div>
        </div>
      </div>
    </main>

    <!-- Mobile Nav -->
    <nav class="mobile-nav">
      <div class="mobile-nav-inner">
        <div class="mobile-nav-item active" data-page="upload" onclick="navigateTo('upload')">
          업로드
        </div>
        <div class="mobile-nav-item" data-page="browse" onclick="navigateTo('browse')">
          탐색
        </div>
        <div class="mobile-nav-item" data-page="friends" onclick="navigateTo('friends')">
          친구
        </div>
        <div class="mobile-nav-item" data-page="classmates" onclick="navigateTo('classmates')">
          학우
        </div>
        <div class="mobile-nav-item" data-page="profile" onclick="navigateTo('profile')">
          계정
        </div>
        <div class="mobile-nav-item" data-page="quiz" onclick="navigateTo('quiz')">
          퀴즈
        </div>
      </div>
    </nav>
  </div>

  <!-- ADMIN DASHBOARD -->
  <div id="admin-dashboard" class="dashboard hidden">
    <div class="mobile-header flex items-center justify-between">
      <h1>관리자</h1>
      <button class="btn btn-secondary btn-sm" onclick="logout()">로그아웃</button>
    </div>
    <aside class="sidebar">
      <div class="sidebar-logo">관리자 대시보드</div>
      <nav class="sidebar-nav">
        <div class="nav-item" data-page="admin-users" onclick="adminNavigateTo('admin-users')">
          계정 관리
        </div>
        <div class="nav-item" data-page="admin-worksheets" onclick="adminNavigateTo('admin-worksheets')">
          학습지 관리
        </div>
        <div class="nav-item" data-page="admin-subjects" onclick="adminNavigateTo('admin-subjects')">
          과목 관리
        </div>
        <div class="nav-item" data-page="admin-settings" onclick="adminNavigateTo('admin-settings')">
          시스템 설정
        </div>
      </nav>
      <div class="sidebar-footer">
        <button class="btn btn-secondary btn-sm btn-full" onclick="logout()">로그아웃</button>
      </div>
    </aside>
    <main class="main-content">
      <!-- ADMIN USERS PAGE -->
      <div id="page-admin-users" class="page">
        <div class="page-header flex items-center justify-between">
          <div>
            <h2>계정 관리</h2>
            <p>계정 추가/삭제 및 포인트 관리</p>
          </div>
          <button class="btn btn-primary" onclick="openAddUserModal()">+ 계정 추가</button>
        </div>
        <div class="card" style="overflow-x:auto">
          <table class="admin-table">
            <thead>
              <tr>
                <th>계정</th>
                <th>상태</th>
                <th>포인트</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="admin-users-tbody"></tbody>
          </table>
        </div>
      </div>
      <!-- ADMIN WORKSHEETS PAGE -->
      <div id="page-admin-worksheets" class="page hidden">
        <div class="page-header">
          <h2>학습지 관리</h2>
          <p>조회수 수정 및 삭제 관리</p>
        </div>
        <div class="card" style="overflow-x:auto">
          <table class="admin-table">
            <thead>
              <tr>
                <th>제목</th>
                <th>과목</th>
                <th>업로더</th>
                <th>조회수</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="admin-worksheets-tbody"></tbody>
          </table>
        </div>
      </div>
      <!-- ADMIN SUBJECTS PAGE -->
      <div id="page-admin-subjects" class="page hidden">
        <div class="page-header">
          <h2>과목 관리</h2>
          <p style="color:var(--danger)">WARNING: 과목 삭제 시 연동된 모든 학습지와 파일이 영구 삭제됩니다.</p>
        </div>
        <div class="card" style="overflow-x:auto">
          <table class="admin-table">
            <thead>
              <tr>
                <th>과목 이름</th>
                <th>생성자</th>
                <th>포함된 학습지 수</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="admin-subjects-tbody"></tbody>
          </table>
        </div>
      </div>
      <!-- ADMIN SETTINGS PAGE -->
      <div id="page-admin-settings" class="page hidden">
        <div class="page-header">
          <h2>시스템 설정</h2>
          <p>외부 서비스 및 저장소 연동 관리</p>
        </div>
        <div class="card" style="max-width: 500px;">
          <h3>구글 드라이브(대용량 보관소) 연동</h3>
          <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">PDF나 한글 파일 등 10MB 이상의 대용량 학습지는 관리자의 구글 드라이브 계정에
            저장됩니다.</p>
          <div
            style="background: #f9fafb; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between;">
            <div>
              <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">현재 상태</div>
              <div id="gdrive-status-text" style="font-weight: 500; font-size: 15px;">상태 확인 중...</div>
            </div>
            <div>
              <button class="btn btn-sm btn-primary" id="gdrive-connect-btn" style="display: none;"
                onclick="connectGoogleDrive()">구글 계정 연동하기</button>
              <button class="btn btn-sm" id="gdrive-disconnect-btn"
                style="display: none; background: #fee2e2; color: #dc2626; border: 1px solid #fecaca;"
                onclick="disconnectGoogleDrive()">연동 해제</button>
            </div>
          </div>
        </div>
        <!-- 저장 공간 현황 -->
        <div class="card" style="max-width: 500px; margin-top: 16px;">
          <h3>저장 공간 현황</h3>
          <p style="color: #666; font-size: 0.85em; margin-bottom: 15px;">Cloudinary 및 MongoDB 사용량을 확인합니다.</p>
          <div id="storage-info" style="font-size:.85rem;color:var(--text2)">로딩 중...</div>
        </div>
      </div>
    </main>
  </div>

  <!-- MODALS -->
  <div id="modal-container" class="hidden"></div>

  <script src="app.js"></script>
</body>

</html>